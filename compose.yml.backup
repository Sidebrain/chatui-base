services:
    frontend:
        build:
            context: ./chat-base
        container_name: chat-frontend
        volumes:
            - ./chat-base:/app/chat-base
            - /app/chat-base/node_modules ## anonymous volume for node_modules
            - ./nginx:/etc/nginx
            # - ./certbot/conf:/etc/letsencrypt
            # - ./certbot/www:/var/www/certbot
        ports:
            - 80:80
            - 443:443
        restart: unless-stopped
        networks:
            - default
        env_file:
            - ./chat-base/.env
        depends_on:
            - backend

    backend:
        build:
            context: ./backend
        container_name: chat-backend
        volumes:
            - ./backend:/app/backend
        ports:
            - 8008:8008
        env_file:
            - ./backend/.env
        networks:
            - default
    # certbot:
    #     container_name: certbot
    #     image: certbot/certbot
    #     volumes:
    #         - ./certbot/conf:/etc/letsencrypt
    #         - ./certbot/www:/var/www/certbot
    #     command: certonly --webroot -w /var/www/certbot --force-renewal --email anudeep@sidebrain.co -d sidebrain.co -d www.sidebrain.co --agree-tos
    #     depends_on:
    #         - frontend
    #     networks:
    #         - default
networks:
    default:
        name: chat-network
        driver: bridge
